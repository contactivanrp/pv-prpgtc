<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Feedback Form</title>
		<link rel="icon" type="image/png" href="im/logo.png" />

		<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter" />

		<link rel="stylesheet" href="css/bootstrap.min.css" type="text/css" id="bootstrap" />
		<link rel="stylesheet/less" type="text/css" href="css/custom.less" />

		<!-- start of additional styling -->

		<link rel="stylesheet/less" href="css/_navbar.less" type="text/css" />
		<link rel="stylesheet/less" href="css/_page_header.less" type="text/css" />
		<link rel="stylesheet/less" type="text/css" href="css/_button_submit.less" />

		<!-- end of additional styling -->

		<script src="js/less.js" type="text/javascript"></script>

		<script>
			less = { env: "development" };
		</script>
		<script src="less.js"></script>
		<script>
			less.watch();
		</script>
	</head>

	<body>
		<div class="f-form-container">
			<form id="feedbackForm" novalidate>
				<div class="form-field-container">
					<h5>1st Registered Lessee</h5>

					<div class="form-field-group">
						<label for="name" class="form-label">Name</label>
						<input type="text" class="form-control" id="name" name="name" placeholder="1st Registered Lessee" check="required" />
						<div class="error-message"></div>
					</div>

					<div class="form-field-group">
						<label for="name" class="form-label">Partial NRIC No.</label>
						<input type="text" class="form-control" id="name" name="name" placeholder="Last 3 digits & last alphabet." check="required" />
						<div class="error-message"></div>
					</div>

					<div class="form-field-group">
						<label for="address" class="form-label">Contact No.</label>
						<input type="text" class="form-control" id="address" name="address" placeholder="Contact No." check="required tel" />
						<div class="error-message"></div>
						<div class="form-desc">Information provided through this form will be used solely for the purpose of facilitating the Bulky Refuse Removal service.</div>
					</div>

					<div class="form-field-group">
						<label for="email" class="form-label">Email</label>
						<input type="email" class="form-control" id="email" name="email" placeholder="you@company.com" check="required email" />
						<div class="error-message"></div>
					</div>

					<h5>2nd Registered Lessee</h5>

					<div class="form-field-group">
						<label for="name" class="form-label">Name</label>
						<input type="text" class="form-control" id="name" name="name" placeholder="1st Registered Lessee" check="required" />
						<div class="error-message"></div>
					</div>

					<div class="form-field-group">
						<label for="name" class="form-label">Partial NRIC No.</label>
						<input type="text" class="form-control" id="name" name="name" placeholder="Last 3 digits & last alphabet." check="required" />
						<div class="error-message"></div>
					</div>

					<div class="form-field-group">
						<label for="address" class="form-label">Contact No.</label>
						<input type="text" class="form-control" id="address" name="address" placeholder="Contact No." check="required tel" />
						<div class="error-message"></div>
					</div>

					<div class="form-field-group">
						<label for="email" class="form-label">Email</label>
						<input type="email" class="form-control" id="email" name="email" placeholder="you@company.com" check="required email" />
						<div class="error-message"></div>
					</div>

					<h5>Property Information</h5>

					<div class="form-field-group">
						<label for="address" class="form-label">Property Address</label>
						<input type="text" class="form-control" id="address" name="address" placeholder="Block and street. Unit number (optional)." check="required address" />
						<!-- To modify to ask for singapore postal code, blk, rd, unit etc -->
						<div class="error-message"></div>
					</div>

					<div class="form-field-group">
						<label for="address" class="form-label">Postal Code</label>
						<input type="text" class="form-control" id="address" name="address" placeholder="Block and street. Unit number (optional)." check="required address" />
						<!-- To modify to ask for singapore postal code, blk, rd, unit etc -->
						<div class="error-message"></div>
					</div>

					<div class="form-field-group">
						<label for="address" class="form-label">Correspondence Address</label>
						<input type="text" class="form-control" id="address" name="address" placeholder="Block and street. Unit number (optional)." check="required address" />
						<!-- To modify to ask for singapore postal code, blk, rd, unit etc -->
						<div class="error-message"></div>
					</div>

					<div class="form-field-group">
						<label for="address" class="form-label">Postal Code</label>
						<input type="text" class="form-control" id="address" name="address" placeholder="Block and street. Unit number (optional)." check="required address" />
						<!-- To modify to ask for singapore postal code, blk, rd, unit etc -->
						<div class="error-message"></div>
					</div>

					<div class="text-desc"><span class="highlight">Note:</span> The information in this form shall supersede all relevant information in the Town Council's records. The Town Council reserves the right to reject any incomplete information in this form.</div>
				</div>
				<button type="submit" class="button_submit is-disabled">Submit Form</button>
			</form>
		</div>

		<script src="js/custom.js"></script>
		<script src="js/popper.min.js"></script>
		<script src="js/bootstrap.bundle.min.js"></script>

		<script>
			document.addEventListener("DOMContentLoaded", function () {
				const form = document.getElementById("feedbackForm");
				const submitButton = document.querySelector(".button_submit");
				let isSubmitAttempted = false; // Flag to check if submit has been attempted

				document.querySelectorAll('input[check*="required"], textarea[check*="required"]').forEach((field) => {
					const label = field.parentElement.querySelector("label");
					if (label) {
						label.innerHTML += '<span class="required-tag"> *</span>';
					}
				});

				const inputs = document.querySelectorAll("input, textarea");
				inputs.forEach((input, index) => {
					input.addEventListener("keydown", function (event) {
						if (event.key === "Enter") {
							if (input.tagName.toLowerCase() === "textarea") {
								// Allow the Enter key to function normally in textareas
								return;
							}
							event.preventDefault(); // Prevent form submission on Enter key for input fields

							// Move focus to the next input field if it exists
							const nextInput = inputs[index + 1];
							if (nextInput) {
								nextInput.focus();
							}
						}
					});
				});

				function required(value) {
					return value.trim() !== "";
				}
				function minLength(value, limit) {
					return value.length >= limit;
				}
				function maxLength(value, limit) {
					return value.length <= limit;
				}
				function onlyText(value) {
					return /^[a-zA-Z\s]+$/.test(value);
				}
				function email(value) {
					return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value);
				}
				function address(value) {
					return /^[a-zA-Z0-9\s.,#-]+$/.test(value);
				}
				function tel(value) {
					return /^\d{8}$/.test(value.replace(/\s/g, ""));
				}

				function validateField(field) {
					const checkAttr = field.getAttribute("check");
					if (!checkAttr) {
						return true; // Skip validation if no 'check' attribute
					}

					const checks = checkAttr.split(" ");
					let isValid = true;
					let errorMessage = "";

					// Check for 'required' first and prioritize it
					if (checks.includes("required") && !required(field.value)) {
						isValid = false;
						errorMessage = "This field is required.";
					} else if (field.value.trim() === "") {
						// If the field is not required and empty, it's valid, clear any errors
						field.classList.remove("is-invalid");
						const errorElement = field.parentElement.querySelector(".error-message");
						if (errorElement) {
							errorElement.textContent = "";
						}
						return true; // If the field is not required and empty, it's valid
					} else {
						// Perform other validations if the field is not empty or not just required
						checks.forEach((check) => {
							const [rule, param] = check.split("-");
							if (!isValid) return; // If already invalid, skip further checks

							switch (rule) {
								case "min":
									isValid = minLength(field.value, parseInt(param));
									errorMessage = `Minimum ${param} characters required.`;
									break;
								case "max":
									isValid = maxLength(field.value, parseInt(param));
									errorMessage = `Cannot exceed ${param} characters.`;
									break;
								case "only":
									if (param === "text") {
										isValid = onlyText(field.value);
										errorMessage = "Only text characters are allowed.";
									}
									break;
								case "email":
									isValid = email(field.value);
									errorMessage = "Invalid email address.";
									break;
								case "address":
									isValid = address(field.value);
									errorMessage = "Invalid address format.";
									break;
								case "tel":
									isValid = tel(field.value);
									errorMessage = "Invalid phone number format.";
									break;
							}
						});
					}

					const errorElement = field.parentElement.querySelector(".error-message");
					if (!isValid && isSubmitAttempted) {
						field.classList.add("is-invalid");
						if (errorElement) {
							errorElement.textContent = errorMessage;
						}
					} else {
						field.classList.remove("is-invalid");
						if (errorElement) {
							errorElement.textContent = "";
						}
					}

					return isValid;
				}

				function validateForm() {
					let isFormValid = true;
					form.querySelectorAll(".form-control").forEach((field) => {
						if (!validateField(field)) {
							isFormValid = false;
						}
					});

					// Update submit button class based on form validity
					submitButton.classList.toggle("is-disabled", !isFormValid);

					if (isFormValid && !isSubmitAttempted) {
						// Set the flag when form validation passes without errors
						isSubmitAttempted = true;
					}

					return isFormValid;
				}

				form.querySelectorAll(".form-control").forEach((field) => {
					field.addEventListener("input", function () {
						validateField(field); // Validate without showing errors until submit is attempted
						validateForm(); // Call validateForm to update submit button class
					});
				});

				form.addEventListener("submit", function (event) {
					isSubmitAttempted = true; // Set flag on first submit attempt

					if (!validateForm()) {
						event.preventDefault();

						const firstInvalidField = form.querySelector(".is-invalid");
						if (firstInvalidField) {
							firstInvalidField.focus();
						}
					} else {
						// Form is valid, perform submission logic here
						console.log("Form submitted successfully!");
					}
				});

				// Perform a silent validation on load to set initial state of the submit button
				validateForm();
			});
		</script>
	</body>
</html>
